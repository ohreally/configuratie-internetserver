#!/usr/bin/env nft -f

################################################################################
#
# Configuratie voor de nftables firewall onder Linux.
#
# /etc/nftables/inet-filter
#
# Meer info: https://www.librobert.net/boek/internet
#
################################################################################
#
# Copyright (c) 2019 Robert LA LAU < https://www.librobert.net/ >
#
# Dit werk is gelicenseerd onder een Creative Commons Naamsvermelding 4.0 Internationaal licentie.
# Bezoek http://creativecommons.org/licenses/by/4.0/ om een kopie te zien van de licentie
# of stuur een brief naar Creative Commons, PO Box 1866, Mountain View, CA 94042, USA.
#
################################################################################

flush ruleset

define interface = "enp1s0"

table inet filter {
	set tcp_ok {
		type inet_service
	}

	set udp_ok {
		type inet_service
	}

	set vertrouwd {
		type ipv4_addr
	}

	set filter {
		type ipv4_addr
	}

	set martians {
		type ipv4_addr
		flags constant, interval
		elements = {
			0.0.0.0/8,
			127.0.0.0/8,
			172.16.0.0/12,
			192.0.0.0/24,
			192.0.2.0/24,
			192.168.0.0/16,
			198.18.0.0/15,
			198.51.100.0/24,
			203.0.113.0/24
		}
	}

	chain input {
		type filter hook input priority 0
		policy drop
		ct state established,related accept
		iif lo accept
		iifname $interface ip saddr @vertrouwd accept
		ip saddr @filter drop
		ip saddr @martians drop
		ip daddr @martians drop
		iifname $interface tcp dport 22 accept
		iifname $interface tcp dport @tcp_ok accept
		iifname $interface udp dport @udp_ok accept
	}
}
